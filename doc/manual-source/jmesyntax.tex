%Copyright 2011 Newcastle University
%
%   Licensed under the Apache License, Version 2.0 (the "License");
%   you may not use this file except in compliance with the License.
%   You may obtain a copy of the License at
%
%       http://www.apache.org/licenses/LICENSE-2.0
%
%   Unless required by applicable law or agreed to in writing, software
%   distributed under the License is distributed on an "AS IS" BASIS,
%   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
%   See the License for the specific language governing permissions and
%   limitations under the License.

\begin{chapter}{\label{cha:jme_syntax}JME syntax}
  JME syntax is used to define variables, functions, and the answers to JME
  question parts, and whenever you want to perform calculations.  Simple
  examples of JME syntax are shown in the examples in
  \S\ref{sec:declaring_variables}.

  The syntax uses infix notation, like you would see in many common programming
  languages, such as C or Fortran, \eg \verb"x*y", \verb"2+z^2", \verb"cos(x)",
  \verb"sqrt(abs(y^3))".  There is no flow or control code in the syntax, so
  constructs like loops and conditional expressions are not possible.  There
  is, however, the facility for basic conditional statements in variable
  declarations, as explained in \S\ref{sec:conditionals}.

  \section{\label{sec:jme_data_types}Data types}
  All variables and values have a type.  The types are
  %
  \begin{description}
    \item[number] A number can be integer (\eg \verb"1"), real (\eg
      \verb"1.467"), or complex (\eg \verb"3+5i").  Fractions can either be
      expressed in the usual way, \eg \verb"a/b", or as a real number with the
      simplification rule \verb"fractionnumbers" enabled.
    \item[string] To write a string, enclose it in single-quotes, \eg
      \verb"'Hello'".
    \item[boolean] A boolean value is either \verb"true" or \verb"false".
    \item[name] Variables have a name, \eg \verb"x", \verb"surname",
      \verb"answer".  Names should start with a letter, which can be followed
      by any number of letters and digits.  The names \verb"pi", \verb"e", and
      \verb"i" are reserved to represent special constants, and so cannot be
      used as user-defined variable names. Names are not case-sensitive.
    \item[function] There is an extensive set of functions available, such as
      \verb"cos()", \verb"abs()", \verb"round()", \etc  A full list of all
      functions is given in \S\ref{sec:jme_op_func}.  You can also define
      your own functions (see \S\ref{sec:functions}).
    \item[op] Besides the usual mathematical operators (\verb"+", \verb"-",
      \verb"*", \verb"/"), there are several more, as listed in
      \S\ref{sec:jme_op_func}.
    \item[range] A \emph{range} represents a discrete set of numbers evenly
      spaced between two other numbers.  A range is defined as \verb"a..b#n" If
      a step size is not defined, it defaults to 1.  Ranges are most often used
      when defining random variables --- see \S\ref{sec:randomisation}.
    \item[list] A \emph{list} is a finite collection of elements of any type
      --- see \S\ref{sec:lists}.
  \end{description}

  \section{\label{sec:jme_op_func}JME operations and functions}
  The following tables list all supported operations and functions. Note that
  all the trigonometric functions work in radians.

  \begin{table}[ht]
    \centering
    \begin{tabular}{lp{20em}l}
      \hline
      Operator & Meaning & Example usage \\
      \hline
      \verb"+" & Addition ($a+b$) & \verb"a+b" \\
      \verb"-" & Subtraction ($a-b$) & \verb"a-b" \\
      \verb"*" & Multiplication ($a\times b$) & \verb"a*b" \\
      \verb"/" & Division ($\frac{a}{b}$) & \verb"a/b" \\
      \verb"^" & Exponentiation ($a^{b}$) & \verb"a^b" \\
      \verb".." & Define a range ($\{x \in \mathbb{N} | a \leq x \leq b\}$) &
      \verb"a..b" \\
      \verb"#" & Add a step size $n$, to the range $[a,b]$ & \verb"a..b#n" \\
      \verb"<" & Less than comparison ($a<b$) & \verb"a<b" \\
      \verb">" & Greater than comparison ($a>b$) & \verb"a>b" \\
      \verb"<="	& Less than or equal to comparison ($a\leq b$) & \verb"a<=b"
      \\
      \verb">="	& Greater than or equal to comparison ($a\geq b$) & \verb"a>=b"
      \\
      \verb"|" or \verb"divides" & Divides ($a|b$, \verb"true" if $b=am$,
      $a,b,m \in \mathbb{Z}$) & \verb"a|b" \\
      \verb"<>" & Inequality comparison ($a\neq b$)	& \verb"a<>b" \\
      \verb"=" & Equality comparison ($a==b$) & \verb"a=b" \\
      \verb"!" or \verb"not" & logical NOT ($\lnot a$)	& \verb"!a" \\
      \verb"&" or \verb"and" & logical AND ($a\land b$) & \verb"a and b" \\
      \verb"||" or \verb"or" & logical OR ($a\lor b$) & \verb"a or b" \\
      \verb"xor" & logical XOR ($a\oplus b$) & \verb"a xor b" \\
      \verb"isa" & Examine data type of a value & \verb"a isa 'number'" \\
      \hline
    \end{tabular}
    \caption{\label{tab:operations}
    	The operations allowed in JME syntax. 
    }
  \end{table}

  \begin{sidewaystable}[ht]
  	\centering
  	\begin{tabular}{llll}
  		\hline
  		Function & Argument type & Result type & Meaning \\
  		\hline
      \verb"abs(x)" & number & number & Absolute value of a number $\abs{x}$ \\
      \verb"arg(z)"	& number & number	& Argument of a complex number $\arg{(z)}$ \\
      \verb"conj(z)" & number & number & Complex conjugate $z^{*}$ \\
      \verb"re(z)" & number & number & Real part of a complex number $\Re{(z)}$ \\
  		\verb"im(z)" & number & number & Imaginary part of a complex number
      $\Im{(z)}$ \\
      \verb"isint(x)"	& number & boolean & \verb"true" if $x$ is an
      integer; \verb"false" otherwise \\
      \verb"sqrt(x)" & number & number & Square root of a number $\sqrt{x}$ \\
      \verb"root(x,n)" & number, number & number & $n$th root of a number $x^{\frac{1}{n}}$ \\
      \verb"ln(x)" & number & number & Natural logarithm of a number $\ln{(x)}$ \\
      \verb"log10(x)" & number & number	& Logarithm to base 10 of a number $\log_{10}{(x)}$ \\
      \verb"exp(x)" & number & number & Exponential function $\mathrm{e}^{x}$
      \\
      \verb"max(x,y)" & number, number & number & Maximum of two numbers $\max{(x,y)}$ \\
      \verb"min(x,y)"	& number, number & number & Minimum of two numbers $\min{(x,y)}$ \\
      \verb"sign(x)" & number & number & Sign of $x$: $-1$, $0$ or $+1$ \\
      \hline\hline
  	\end{tabular}
  	\caption{\label{tab:numberfunctions}
  		Basic functions for dealing with numbers.
  	}
  \end{sidewaystable}
  
  \begin{sidewaystable}[ht]
  	\centering
  	\begin{tabular}{llll}
  		\hline
  		Function & Argument type & Result type & Meaning \\
  		\hline
  		\verb"ceil(x)" & number & number & Round up to nearest whole number \\
  		\verb"floor(x)" & number & number & Round down to nearest whole number \\
  		\verb"round(x)"	& number & number & Round to nearest whole number \\
  		\verb"trunc(x)" & number & number & Integer part of $x$ \\
  		\verb"fract(x)" & number & number & Fractional part of $x$ \\
      \verb"precround(x,n)" & number, number & number & Round $x$ to $n$
      decimal places \\
      \verb"siground(x,n)" & number, number & number & Round $x$ to $n$
      significant figures \\
  	\end{tabular}
  	\caption{\label{tab:roundingfunctions}
  		Functions for rounding numbers.
  	}
  \end{sidewaystable}

  \begin{sidewaystable}[ht]
  	\centering
  	\begin{tabular}{llll}
  		\hline
  		Function & Argument type & Result type & Meaning \\
  		\hline
  		\verb"sin(x)"			& number & number & Sine \\
  		\verb"cos(x)"			& number & number & Cosine \\
  		\verb"tan(x)"			& number & number & Tangent \\
  		\verb"cosec(x)"		& number & number & Cosecant \\
  		\verb"sec(x)"			& number & number & Secant \\
  		\verb"cot(x)"			& number & number & Cotangent \\
  		\verb"arcsin(x)"	& number & number & Inverse sine \\
  		\verb"arccos(x)"	& number & number & Inverse cosine \\
  		\verb"arctan(x)"	& number & number & Inverse tangent \\
  		\verb"sinh(x)"		& number & number & Hyperbolic sine \\
  		\verb"cosh(x)"		& number & number & Hyperbolic cosine \\
  		\verb"tanh(x)"		& number & number & Hyperbolic tangent \\
  		\verb"cosech(x)"	& number & number & Hyperbolic cosecant \\
  		\verb"sech(x)"		& number & number & Hyperbolic secant \\
  		\verb"coth(x)"		& number & number & Hyperbolic cotangent\\
  		\verb"arcsinh(x)"	& number & number & Inverse hyperbolic sine \\
  		\verb"arccosh(x)"	& number & number & Inverse hyperbolic cosine \\
  		\verb"arctanh(x)"	& number & number & Inverse hyperbolic tangent \\
  		\verb"degrees(x)"	& number & number & Convert radians to degrees \\
  		\verb"radians(x)"	& number & number & Convert degrees to radians \\
  	\end{tabular}
  	\caption{\label{tab:trigfunctions}
  		Trigonometry functions.
  	}
  \end{sidewaystable}

  \begin{sidewaystable}[ht]
  	\centering
  	\begin{tabular}{llll}
    	\hline
  		Function & Argument type & Result type & Meaning \\
  		\hline
		  \verb"fact(x)" & number & number & Factorial of an integer $x!$ \\
      \verb"mod(x,n)" & number, number & number & Modulo $x\mod{n}$ \\
      \verb"perm(n,r)" & number, number & number & Permutations $^{n}P_{r}$ \\
      \verb"comb(n,r)" & number, number & number & Combinations $^{n}C_{r}$ \\
  		\verb"gcd(a,b)" & number, number & number & Greatest common divisor of $a$
      and $b$ \\
  		\verb"lcm(a,b)"	& number, number & number & Lowest common multiple of $a$
      and $b$ \\
  	\end{tabular}
  	\caption{\label{tab:numbertheoryfunctions}
  		Number-theoretical operations.
  	}
  \end{sidewaystable}

  \begin{sidewaystable}[ht]
  	\centering
    \begin{tabular}{lllp{20em}}
    	\hline
  		Function & Argument type & Result type & Meaning \\
  		\hline
		  \verb"repeat(f,n)" & expr, number & list & Evaluate an expression a
      given number of times \\
      \verb"map(f,x,[])" & expr, var, list & list & Map an expression to a list
      \\
      \verb"abs([])" & list & number & Size of a list \\
  	\end{tabular}
  	\caption{\label{tab:listfunctions}
  		List operations.
  	}
  \end{sidewaystable}

  \begin{sidewaystable}[ht]
  	\centering
    \begin{tabular}{lllp{20em}}
  		\hline
  		Function & Argument type & Result type & Meaning \\
  		\hline
      \verb"random(a..b#n)"	& range & number & Choose discrete random variable
      from range $[a,b]$ in steps of $n$.  If $n=0$, then choose continuous
      random variable from range $[a,b]$.\\
      \verb"random(a1,a2,...,aN)"	& any & number & Choose $a_{i}$ randomly from
      $(a_1, a_2, \ldots, a_N)$ \\
      \verb"award(n,b)"	& number, boolean & number & $n$ if $b$ is \verb"true",
      $0$ otherwise \\
  		\verb"if(cond,expr,else)" & boolean, any, any & any	& If/Else (see
      \S\ref{sec:conditionals}) \\
      \verb"switch(cond1,expr1,...)" & Pairs of boolean, any & any & Select
      between cases (see \S\ref{sec:conditionals})\\
  	\end{tabular}
  	\caption{\label{tab:choicefunctions}
  		Functions for choosing between values
  	}
  \end{sidewaystable}
\end{chapter}
